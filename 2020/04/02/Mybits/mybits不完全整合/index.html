<!DOCTYPE html>
<html lang="en">

<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
	
	<!-- title -->
	
	<title>
	
		Mybits/mybits不完全整合 | 
	 
	柠檬
	</title>
	
	<!-- keywords,description -->
	 

	<!-- favicon -->
	
	<link rel="shortcut icon" href="/favicon.ico">
	
  

	
<link rel="stylesheet" href="/css/main.css">

	
<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css">

	
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/styles/darcula.min.css">


	
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/highlight.min.js"></script>

	
<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>

	
<script src="https://cdn.jsdelivr.net/npm/jquery-pjax@2.0.1/jquery.pjax.min.js"></script>

	
<script src="/js/main.js"></script>

	
		
<script src="https://cdn.jsdelivr.net/npm/leancloud-storage/dist/av-min.js"></script>

		
<script src="https://cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js"></script>

	
	
		<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
	
<meta name="generator" content="Hexo 4.2.0"></head>

<body>
	<header id="header">
    <a id="title" href="/" class="logo">柠檬</a>

	<ul id="menu">
		<li class="menu-item">
			<a href="/about" class="menu-item-link">ABOUT</a>
		</li>
		
		<li class="menu-item">
			<a href="https://github.com/wujun234/uid-generator-spring-boot-starter" class="menu-item-link" target="_blank">
				UidGenerator
			</a>
		</li>
		<li class="menu-item">
			<a href="https://github.com/wujun234" class="menu-item-link" target="_blank">
				<i class="fa fa-github fa-2x"></i>
			</a>
		</li>
	</ul>
</header>

	
<div id="sidebar">
	<button id="sidebar-toggle" class="toggle" ><i class="fa fa-arrow-right " aria-hidden="true"></i></button>
	
	<div id="site-toc">
		<input id="search-input" class="search-input" type="text" placeholder="search...">
		<div id="tree">
			

			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										Mybits
									</a>
									
							<ul>
								<li class="file active">
									<a href="/2020/04/02/Mybits/mybits%E4%B8%8D%E5%AE%8C%E5%85%A8%E6%95%B4%E5%90%88/">
										mybits不完全整合
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										初次尝试
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/03/31/%E5%88%9D%E6%AC%A1%E5%B0%9D%E8%AF%95/Hexo%E5%88%9D%E5%B0%9D%E8%AF%95/">
										Hexo初尝试
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										数据库
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/04/02/%E6%95%B0%E6%8D%AE%E5%BA%93/%E4%BA%8B%E7%89%A9/">
										事物
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										特有名次收录
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/04/02/%E7%89%B9%E6%9C%89%E5%90%8D%E6%AC%A1%E6%94%B6%E5%BD%95/%E7%89%B9%E6%9C%89%E5%90%8D%E8%AF%8D/">
										特有名词
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										读java编程思想的感受
									</a>
									
							<ul>
								<li class="file">
									<a href="/2020/04/03/%E8%AF%BBjava%E7%BC%96%E7%A8%8B%E6%80%9D%E6%83%B3%E7%9A%84%E6%84%9F%E5%8F%97/%E7%AC%AC%E4%B8%80%E7%AB%A0%E5%AF%B9%E8%B1%A1%E5%AF%BC%E8%AE%BA/">
										第一章对象导论
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
		</div>
	</div>
</div>

	<!-- 引入正文 -->
	<div id="content">
		<h1 id="article-title">

	mybits不完全整合
</h1>
<div class="article-meta">
	
	<span>John Doe</span>
	<span>2020-04-02 12:26:05</span>
    
		<div id="article-categories">
            
		</div>
    
</div>

<div id="article-content">
	<h1 id="什么是Mybits？"><a href="#什么是Mybits？" class="headerlink" title="什么是Mybits？"></a>什么是Mybits？</h1><p>mybits是一个小型持久层框架，对Jdbc进行了简单的封装，支持定制化SQL语句，使用简单的 XML或注解用于配置和原始映射，将接口和 Java 的POJOs映射成数据库中的记录。</p>
<p>补充一些术语</p>
<p>1、ORM（Object Relation Mapping） 对象关系映射<br> 2、POJO（Plain Old Java Object） 普通Java对象<br> 3、PO（Persisent Object） 持久化对象</p>
<p>mybit有两种映射，一种是xml，一种是注解</p>
<h1 id="Mybits需要的环境"><a href="#Mybits需要的环境" class="headerlink" title="Mybits需要的环境"></a>Mybits需要的环境</h1><p>引入mybatis 和mysql 两个jar即可（我使用了junit 和 hamcrest 帮助测试）</p>
<p>约束有xml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE configuration</span><br><span class="line">        PUBLIC &quot;-&#x2F;&#x2F;mybatis.org&#x2F;&#x2F;DTD Config 3.0&#x2F;&#x2F;EN&quot;</span><br><span class="line">        &quot;http:&#x2F;&#x2F;mybatis.org&#x2F;dtd&#x2F;mybatis-3-config.dtd&quot;&gt;</span><br></pre></td></tr></table></figure>

<p>以及注解</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">        PUBLIC &quot;-&#x2F;&#x2F;mybatis.org&#x2F;&#x2F;DTD Mapper 3.0&#x2F;&#x2F;EN&quot;</span><br><span class="line">        &quot;http:&#x2F;&#x2F;mybatis.org&#x2F;dtd&#x2F;mybatis-3-mapper.dtd&quot;&gt;</span><br></pre></td></tr></table></figure>



<h1 id="Mybits简单应用XML"><a href="#Mybits简单应用XML" class="headerlink" title="Mybits简单应用XML"></a>Mybits简单应用XML</h1><h2 id="一个基础模板"><a href="#一个基础模板" class="headerlink" title="一个基础模板"></a>一个基础模板</h2><p>解析配置文件的技术是dom4j解析xml文件</p>
<p> factory.openSession()有不同的实现方法，其中一个实现方法的输入类型是bollen 用来指定是否自动在最后提交事务，默认false，输入true时就不需要手动提交事务</p>
<pre><code>InputStream in = Resources.getResourceAsStream(&quot;SqlMapConfig.xml&quot;);    //1.读取配置文件
SqlSessionFactoryBuilder builder = new SqlSessionFactoryBuilder();//2.使用建造者模式创建一个SqlSessionFactoryBuilder来帮助我们生产sqlsession

SqlSessionFactory factory = builder.build(in);//3.使用工厂生产sqlsession

SqlSession session = factory.openSession();//4.使用sqlsession创建dao接口的代理对象

IUser userDao = session.getMapper(IUser.class);//指定代理对象代理的接口

&lt;代理对象调用方法&gt;

//关闭流
    @After
    public void destory() throws Exception {
        session.close();
        in.close();
    }</code></pre><h2 id="XML主配置文件-（SqlMapConfig）"><a href="#XML主配置文件-（SqlMapConfig）" class="headerlink" title="XML主配置文件 （SqlMapConfig）"></a>XML主配置文件 （SqlMapConfig）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE configuration</span><br><span class="line">        PUBLIC &quot;-&#x2F;&#x2F;mybatis.org&#x2F;&#x2F;DTD Config 3.0&#x2F;&#x2F;EN&quot;</span><br><span class="line">        &quot;http:&#x2F;&#x2F;mybatis.org&#x2F;dtd&#x2F;mybatis-3-config.dtd&quot;&gt;</span><br><span class="line">&lt;!-- mybits的主配置文件 --&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">&lt;!-- 引用外部数据源 --&gt;&lt;!-- 如果使用url属性，那么值要写file下的全路径，或者带端口号的全路径 --&gt;</span><br><span class="line">&lt;properties resource&#x3D;&quot;jdbcConfig.properties&quot;&gt;&lt;&#x2F;properties&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 配置环境 --&gt;</span><br><span class="line">&lt;environments default&#x3D;&quot;mysql&quot;&gt;</span><br><span class="line">&lt;!-- 配置mysql的环境 --&gt;</span><br><span class="line">	&lt;environment id&#x3D;&quot;mysql&quot;&gt;</span><br><span class="line">	&lt;!-- 配置事物类型 --&gt;</span><br><span class="line">		&lt;transactionManager type&#x3D;&quot;JDBC&quot;&gt;&lt;&#x2F;transactionManager&gt;	</span><br><span class="line">		&lt;!-- 配置数据源(连接池) --&gt; </span><br><span class="line">		&lt;dataSource type&#x3D;&quot;POOLED&quot;&gt;&lt;!--$&#123;里写property对应的name&#125;  --&gt;</span><br><span class="line">			&lt;property name&#x3D;&quot;driver&quot; value&#x3D;&quot;$&#123;jdbc.driver&#125;&quot;&#x2F;&gt;</span><br><span class="line">			&lt;property name&#x3D;&quot;url&quot; value&#x3D;&quot;$&#123;jdbc.url&#125;&quot;&#x2F;&gt;</span><br><span class="line">			&lt;property name&#x3D;&quot;username&quot; value&#x3D;&quot;$&#123;jdbc.username&#125;&quot;&#x2F;&gt;</span><br><span class="line">			&lt;property name&#x3D;&quot;password&quot; value&#x3D;&quot;$&#123;jdbc.password&#125;&quot;&#x2F;&gt;</span><br><span class="line">		&lt;&#x2F;dataSource&gt;</span><br><span class="line">	&lt;&#x2F;environment&gt;</span><br><span class="line">&lt;&#x2F;environments&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 指定映射文件的位置，映射配置文件指的是每个dao独立的配置文件 --&gt;</span><br><span class="line">&lt;mappers&gt;</span><br><span class="line">&lt;!-- 如果使用url属性，那么值要写file下的全路径，或者带端口号的全路径 --&gt;</span><br><span class="line">	&lt;mapper resource&#x3D;&quot;IUserdao.xml&quot;&#x2F;&gt;</span><br><span class="line">&lt;&#x2F;mappers&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;configuration&gt;</span><br></pre></td></tr></table></figure>

<p> properties resource:指定数据源文件</p>
<p>1.environments-default：该属性指定当前的环境，有development和work两种选择，默认是development开发模式；</p>
<p>2.environment-id：该属性是每个environment定义的环境，也有development和work两种选择，默认是development开发模式；</p>
<p>3.transactionManager-type：该属性是配置事务管理器的类型，mybatis中有JDBC和MANAGED两种，一次只能配置一个</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">使用JDBC的事务处理方式，当我向数据库中插入一条数据时，在调用完插入接口执行SQL之后，必须 执行sqlSession.commit();进行提交，否则虽然插入成功但是数据库中还是看不到刚才插入的数据；而使用MANAGED方式就不一样了，只需调用接口即可，无需手动提交。</span><br></pre></td></tr></table></figure>

<p>4.dataSource－type：该属性用来配置数据源类型，有UNPOOLED、POOLED和JNDI三种选择</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">1⃣️UNPOOLED</span><br><span class="line"></span><br><span class="line">采用非数据库池的管理方式，每次请求都会新建一个连接，所以性能不是很高，使用这种数据源的时候，我们可以配置以下属性：</span><br><span class="line"></span><br><span class="line">driver数据库驱动名</span><br><span class="line"></span><br><span class="line">url数据库连接URL</span><br><span class="line"></span><br><span class="line">username用户名</span><br><span class="line"></span><br><span class="line">password密码</span><br><span class="line"></span><br><span class="line">defaultTransactionIsolationLevel默认的事务隔离级别，如果要传递属性给驱动，则属性的前缀为driver</span><br><span class="line"></span><br><span class="line">2⃣️POOLED</span><br><span class="line"></span><br><span class="line">采用连接池的概念将数据库链接对象Connection组织起来，可以在初始化时创建多个连接，使用时直接从连接池获取，避免了重复创建连接所需的初始化和认证时间，从而提升了效率，所以这种方式比较适合对性能要求高的应用中。除了UNPOOLED中的配置属性之外，还有下面几个针对池子的配置：</span><br><span class="line"></span><br><span class="line">poolMaximumActiveConnections：任意时间都会存在的连接数，默认值为10</span><br><span class="line"></span><br><span class="line">poolMaxmumIdleConnections：可以空闲存在的连接数</span><br><span class="line"></span><br><span class="line">poolMaxmumCheckoutTime：在被强制返回之前，检查出存在空闲连接的等待时间。即如果有20个连接，只有一个空闲，在这个空闲连接被找到之前的等待时间就用这个属性配置。</span><br><span class="line"></span><br><span class="line">poolTimeToWait：等待一个数据库连接成功所需的时间，如果超出这个时间则尝试重新连接。</span><br><span class="line"></span><br><span class="line">还有其他的一些配置，不详述了。</span><br><span class="line"></span><br><span class="line">3⃣️JNDI</span><br><span class="line"></span><br><span class="line">数据源JNDI的实现是为了能在如EJB或应用服务器这类容器中使用，容器可以集中或在外部配置数据源，然后放置一个JNDI上下文的引用。这种数据源只需配置两个属性：</span><br><span class="line"></span><br><span class="line">initial_context：用来在InitialContext中寻找上下文。可选，如果忽略，data_source属性将会直接从InitialContext中寻找；</span><br><span class="line"></span><br><span class="line">data_source：引用数据源实例位置上下文的路径。当提供initial_context配置时，data_source会在其返回的上下文进行查找，否则直接从InitialContext中查找。</span><br><span class="line"></span><br><span class="line">除了上述三种数据源之外，mybatis还提供第三方数据源，如DBCP，但是需要我们自定义数据源工厂并进行配置，这一点暂时不做研究。</span><br><span class="line"></span><br><span class="line">以上就是environments运行环境的配置。</span><br></pre></td></tr></table></figure>

<p>5.dataSource中的property元素就是数据库相关的信息</p>
<p>这一段是我将数据库信息单独提出到一个property文件中（jdbcConfig.properties）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;transactionManager type&#x3D;&quot;JDBC&quot;&gt;&lt;&#x2F;transactionManager&gt;	</span><br><span class="line">		&lt;!-- 配置数据源(连接池) --&gt; </span><br><span class="line">		&lt;dataSource type&#x3D;&quot;POOLED&quot;&gt;&lt;!--$&#123;里写property对应的name&#125;  --&gt;</span><br><span class="line">			&lt;property name&#x3D;&quot;driver&quot; value&#x3D;&quot;$&#123;jdbc.driver&#125;&quot;&#x2F;&gt;</span><br><span class="line">			&lt;property name&#x3D;&quot;url&quot; value&#x3D;&quot;$&#123;jdbc.url&#125;&quot;&#x2F;&gt;</span><br><span class="line">			&lt;property name&#x3D;&quot;username&quot; value&#x3D;&quot;$&#123;jdbc.username&#125;&quot;&#x2F;&gt;</span><br><span class="line">			&lt;property name&#x3D;&quot;password&quot; value&#x3D;&quot;$&#123;jdbc.password&#125;&quot;&#x2F;&gt;</span><br><span class="line">		&lt;&#x2F;dataSource&gt;</span><br></pre></td></tr></table></figure>

<p>jdbcConfig.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">jdbc.driver</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="meta">jdbc.url</span>=<span class="string">jdbc:mysql://localhost:3306/mybatis</span></span><br><span class="line"><span class="meta">jdbc.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">jdbc.password</span>=<span class="string">root</span></span><br></pre></td></tr></table></figure>

<p> 指定映射文件的位置，映射配置文件指的是每个dao独立的配置文件 </p>
<p>在一对多，多对多的查询中，要把每个dao加入mapper</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;mappers&gt;</span><br><span class="line">&lt;!-- 如果使用url属性，那么值要写file下的全路径，或者带端口号的全路径 --&gt;</span><br><span class="line">	&lt;mapper resource&#x3D;&quot;IUserdao.xml&quot;&#x2F;&gt;</span><br><span class="line">&lt;&#x2F;mappers&gt;</span><br></pre></td></tr></table></figure>



<h2 id="映射文件"><a href="#映射文件" class="headerlink" title="映射文件"></a>映射文件</h2><h3 id="一般写法"><a href="#一般写法" class="headerlink" title="一般写法"></a>一般写法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">        PUBLIC &quot;-&#x2F;&#x2F;mybatis.org&#x2F;&#x2F;DTD Mapper 3.0&#x2F;&#x2F;EN&quot;</span><br><span class="line">        &quot;http:&#x2F;&#x2F;mybatis.org&#x2F;dtd&#x2F;mybatis-3-mapper.dtd&quot;&gt;</span><br><span class="line">     </span><br><span class="line">&lt;mapper namespace&#x3D;&quot;user.IUser&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 更新用户 --&gt;</span><br><span class="line">&lt;update id&#x3D;&quot;updateuser&quot; parameterType&#x3D;&quot;user.User&quot;&gt;</span><br><span class="line">	update user set username &#x3D; #&#123;username&#125;,birthday&#x3D;#&#123;birthday&#125;,sex&#x3D;#&#123;sex&#125;,address&#x3D;#&#123;address&#125; where id&#x3D;#&#123;id&#125;;     </span><br><span class="line">&lt;&#x2F;update&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 删除 --&gt;</span><br><span class="line">&lt;delete id&#x3D;&quot;delet&quot; parameterType&#x3D;&quot;java.lang.Integer&quot;&gt;</span><br><span class="line">	delete from user where id &#x3D; #&#123;id&#125;;    </span><br><span class="line">&lt;&#x2F;delete&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 根据id查询一个 --&gt;</span><br><span class="line">&lt;select id&#x3D;&quot;findUserById&quot; parameterType&#x3D;&quot;Int&quot; resultType&#x3D;&quot;user.User&quot;&gt;</span><br><span class="line">	select * from user where id &#x3D; #&#123;id&#125;;   </span><br><span class="line">&lt;&#x2F;select&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 查询信息条数 --&gt;</span><br><span class="line">&lt;select id&#x3D;&quot;findTotal&quot;  resultType&#x3D;&quot;int&quot;&gt;</span><br><span class="line">	select count(id) from user; </span><br><span class="line">&lt;&#x2F;select&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;mapper&gt;</span><br></pre></td></tr></table></figure>

<p>mapper -namepace: 这个映射文件的唯一标识</p>
<p>select     inser    update     delete   基础的增删改查</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1.parameterType&#x3D;&quot;输入类型&quot;  在使用基本类型时，大小写均可</span><br><span class="line"></span><br><span class="line">	输入参数为Map集合，SQL语句中的参数为map中的key的名称 </span><br><span class="line"></span><br><span class="line">	输入参数为JavaBean，SQL语句中的参数为bean所对相应的属性名称</span><br><span class="line"></span><br><span class="line">2.resultType&#x3D;&quot;返回类型&quot;  </span><br><span class="line"></span><br><span class="line">	如果返回的是集合(List)的话，集合中每一元素的类型</span><br><span class="line"></span><br><span class="line">	返回Map类型，key为列名，value为对应列的值    </span><br><span class="line"></span><br><span class="line"> 建议：如果我们输入多个参数的话，使用JavaBean,相反使用Map </span><br><span class="line"></span><br><span class="line">3.resultMap</span><br><span class="line">    返回自定义的POJO，多用多表的连接操作（后面多对多再举例，resultMap和resultType只能二选一</span><br></pre></td></tr></table></figure>



<h3 id="一些特殊写法"><a href="#一些特殊写法" class="headerlink" title="一些特殊写法"></a>一些特殊写法</h3><p>1.useGeneratedKeys=”true”  表示当前表应用主键自增长<br>2.keyProperty=”id” 表示返回的主键赋值给当前对象的那个属性，联合主键用’,’号隔开<br>3.keyColumn=””  设置第几列是主键，默认是第一列，联合主键用’,’号隔开 </p>
<p>sql块</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;sql id&#x3D;&quot;selectall&quot;&gt;</span><br><span class="line">select * from user</span><br><span class="line">&lt;&#x2F;sql&gt;</span><br><span class="line">&lt;!-- 查询所有 --&gt;</span><br><span class="line">&lt;select id&#x3D;&quot;findAlluser&quot; resultType&#x3D;&quot;user.User&quot;&gt;</span><br><span class="line">	&lt;include refid&#x3D;&quot;selectall&quot;&gt;&lt;&#x2F;include&gt;</span><br><span class="line">&lt;&#x2F;select&gt;</span><br></pre></td></tr></table></figure>

<p>可以获取插入后的id</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 添加用户 --&gt;</span><br><span class="line">&lt;insert id&#x3D;&quot;saveuser&quot; parameterType&#x3D;&quot;user.User&quot;&gt;</span><br><span class="line">	&lt;!-- 配置插入后，获取插入的id --&gt;</span><br><span class="line">	&lt;selectKey keyProperty&#x3D;&quot;id&quot; keyColumn&#x3D;&quot;id&quot; resultType&#x3D;&quot;int&quot; order&#x3D;&quot;AFTER&quot;&gt;</span><br><span class="line">		select last_insert_id();</span><br><span class="line">	&lt;&#x2F;selectKey&gt;</span><br><span class="line">	insert into user(username,birthday,sex,address)values(#&#123;username&#125;,#&#123;birthday&#125;,#&#123;sex&#125;,#&#123;address&#125;);</span><br><span class="line">&lt;&#x2F;insert&gt;</span><br></pre></td></tr></table></figure>

<p>类模糊查询（使用另一个类的字段查询）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 根据类模糊查询 --&gt;</span><br><span class="line">&lt;select id&#x3D;&quot;findUserByVo&quot; parameterType&#x3D;&quot;user.QueryVo&quot; resultType&#x3D;&quot;user.User&quot;&gt;</span><br><span class="line">	select * from user where username like #&#123;user.username&#125;;   </span><br><span class="line">&lt;&#x2F;select&gt;</span><br></pre></td></tr></table></figure>

<p>模糊查询</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 根据id模糊查询 --&gt;</span><br><span class="line">&lt;select id&#x3D;&quot;findUserByNotSureName&quot; parameterType&#x3D;&quot;String&quot; resultType&#x3D;&quot;user.User&quot;&gt;</span><br><span class="line">	select * from user where username like #&#123;username&#125;;   </span><br><span class="line">&lt;&#x2F;select&gt;</span><br></pre></td></tr></table></figure>

<p>注： 模糊查询有两种，一种是在输入时提供百分号，而sql语句会使用？占位，这样可以防止sql注入<br>另一种方式是在语句中写%  如’%${username}%’   这样就不安全  </p>
<h3 id="动态sql"><a href="#动态sql" class="headerlink" title="动态sql"></a>动态sql</h3><p>1.<if>元素   当条件成立时，会将条件里的语句拼接到原语句的后面</p>
<p>注意：在原语句后面要写一个1=1防止不成立时直接拼接报错</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 根据条件查询一个 --&gt;</span><br><span class="line">&lt;select id&#x3D;&quot;findUserByUname&quot; parameterType&#x3D;&quot;String&quot; resultType&#x3D;&quot;user.User&quot;&gt;</span><br><span class="line">	select * from user where 1&#x3D;1</span><br><span class="line">	&lt;if test&#x3D;&quot;username !&#x3D; null&quot;&gt;</span><br><span class="line">	and username &#x3D; #&#123;username&#125;</span><br><span class="line">	&lt;&#x2F;if&gt;</span><br><span class="line">&lt;&#x2F;select&gt;</span><br></pre></td></tr></table></figure>

<p>2.<where>元素<br>       步骤1.如果条件不为空，自动拼接where关键字，否则不加。<br>       步骤2.去掉最前面多余的and 或者 or</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 根据条件查询一个 --&gt;</span><br><span class="line">&lt;select id&#x3D;&quot;findUserByUname&quot; parameterType&#x3D;&quot;String&quot; resultType&#x3D;&quot;user.User&quot;&gt;</span><br><span class="line">	select * from user </span><br><span class="line">	&lt;where&gt;</span><br><span class="line">	&lt;if test&#x3D;&quot;username !&#x3D; null&quot;&gt;</span><br><span class="line">	and username &#x3D; #&#123;username&#125;</span><br><span class="line">	&lt;&#x2F;if&gt;</span><br><span class="line">	&lt;&#x2F;where&gt;</span><br><span class="line">&lt;&#x2F;select&gt;</span><br></pre></td></tr></table></figure>

<p>3.<choose>、<when>、<otherwise>元素  </p>
<p>choose标签是按顺序判断其内部when标签中的test条件出否成立，如果有一个成立，则 choose 结束。当 choose 中所有 when 的条件都不满则时，则执行 otherwise 中的sql。类似于Java 的 switch 语句，choose 为 switch，when 为 case，otherwise 则为 default。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">5.2 </span><br><span class="line">   &lt;choose&gt;</span><br><span class="line">	 &lt;when test&#x3D;&quot;username !&#x3D;null and username!&#x3D;&#39;&#39;&quot;&gt;&lt;&#x2F;when&gt;</span><br><span class="line">	 &lt;otherwise&gt;gender&#x3D;#&#123;gender&#125;&lt;&#x2F;otherwise&gt;		</span><br><span class="line">   &lt;&#x2F;choose&gt;</span><br></pre></td></tr></table></figure>

<p>4.<set>元素     主要用于修改语句    </p>
<pre><code>步骤1.自动加上set关键字 。
步骤2.去掉最最后多余的&quot;,&quot;号
要求：更新字段不能都为空</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;update id&#x3D;&quot;updateEmprById2&quot; parameterType&#x3D;&quot;emp&quot;&gt;</span><br><span class="line">		UPDATE emp</span><br><span class="line">		&lt;set&gt;</span><br><span class="line">			&lt;if test&#x3D;&quot;ename!&#x3D;null&quot;&gt; ename&#x3D;#&#123;ename&#125;,&lt;&#x2F;if&gt;</span><br><span class="line">			&lt;if test&#x3D;&quot;job!&#x3D;null&quot;&gt; job&#x3D;#&#123;job&#125;,&lt;&#x2F;if&gt;</span><br><span class="line">		&lt;&#x2F;set&gt;</span><br><span class="line">		&lt;where&gt;</span><br><span class="line">			&lt;if test&#x3D;&quot;empno!&#x3D;null&quot;&gt;</span><br><span class="line">				empno&#x3D;#&#123;empno&#125;;</span><br><span class="line">			&lt;&#x2F;if&gt;</span><br><span class="line">		&lt;&#x2F;where&gt;</span><br><span class="line">	&lt;&#x2F;update&gt;</span><br></pre></td></tr></table></figure>

<p>5.<trim>标记是一个格式化的标记，可以完成set或者是where标记的功能。</p>
<p>​    prefix=”where”  最前面加上where关键字<br>​    2.prefixOverrides=”and|or”  去掉最前面的and或者or关键字<br>​    3.suffix=”)”  最后面加上”)”<br>​    4.suffixOverrides=”,”  去掉最后面的”,”号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;trim&gt;</span><br><span class="line">   &lt;trim prefix&#x3D;&quot;where&quot; prefixOverrides&#x3D;&quot;and|or&quot;&gt;	 </span><br><span class="line">  &lt;if test&#x3D;&quot;username !&#x3D;null and username!&#x3D;&#39;&#39;&quot;&gt;</span><br><span class="line">	and username like CONCAT(&#39;%&#39;,#&#123;username&#125;,&#39;%&#39;)</span><br><span class="line">  &lt;&#x2F;if&gt;		</span><br><span class="line">&lt;&#x2F;trim&gt;</span><br><span class="line">&lt;trim prefix&#x3D;&quot;(&quot; suffix&#x3D;&quot;)&quot; suffixOverrides&#x3D;&quot;,&quot;&gt;</span><br><span class="line">   &lt;if test&#x3D;&quot;1&#x3D;&#x3D;1&quot;&gt;username, password,&lt;&#x2F;if&gt;</span><br><span class="line">   &lt;if test&#x3D;&quot;gender !&#x3D;null and gender!&#x3D;&#39;&#39;&quot;&gt;gender,&lt;&#x2F;if&gt;</span><br><span class="line">&lt;&#x2F;trim&gt;</span><br></pre></td></tr></table></figure>

<p>6.<bind>元素    声明了一个参数usernameBind在后面就可以使用了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line">  &lt;select id&#x3D;&quot;getEmpById6&quot; resultType&#x3D;&quot;emp&quot;&gt;</span><br><span class="line">	&lt;bind name&#x3D;&quot;usernameBind&quot; value&#x3D;&quot;&#39;%&#39;+username+&#39;%&#39;&quot;&#x2F;&gt;</span><br><span class="line">	select * from emp where name&#x3D;$&#123;usernameBind&#125;</span><br><span class="line">&lt;&#x2F;select&gt;</span><br></pre></td></tr></table></figure>

<p>7.<foreach>元素 </p>
<p>foreach用来遍历，遍历的对象可以是数组，也可以是集合。<br>相关属性：<br>Collection：collection属性的值有三个分别是list、array、map三种。<br>Open：前缀。<br>Close：后缀。<br>Separator：分隔符，表示迭代时每个元素之间以什么分隔。<br>Item：表示在迭代过程中每一个元素的别名。<br>Index：用一个变量名表示当前循环的索引位置。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">	&lt;!--1、应用于查询，参数为List&lt;Integer&gt; --&gt;</span><br><span class="line">		select * from emp where name in </span><br><span class="line">	   &lt;foreach collection&#x3D;&quot;list&quot; item&#x3D;&quot;item&quot; open&#x3D;&quot;(&quot; close&#x3D;&quot;)&quot;</span><br><span class="line">			separator&#x3D;&quot;,&quot;&gt;#&#123;item&#125;&lt;&#x2F;foreach&gt;</span><br><span class="line">	   1.参数：List&lt;Integer&gt; &#x3D; &#123;1,2,3&#125;</span><br><span class="line">	   2.最终SQL语句：select * from emp where name in （1,2,3）</span><br><span class="line">	   </span><br><span class="line">	&lt;!--2、应用于查询，参数为int[] ids --&gt;</span><br><span class="line">		select * from emp where name in </span><br><span class="line">	   &lt;foreach collection&#x3D;&quot;array&quot; item&#x3D;&quot;item&quot; open&#x3D;&quot;(&quot; close&#x3D;&quot;)&quot;&gt;#&#123;item&#125;&lt;&#x2F;foreach&gt;</span><br><span class="line">	   1.参数：int[] ids &#x3D; &#123;1,2,3&#125;</span><br><span class="line">	   2.最终SQL语句：select * from emp where name in （1,2,3）</span><br><span class="line">	   </span><br><span class="line">	&lt;!--3、应用于查询，参数为HashMap --&gt;</span><br><span class="line">	  select * from emp where name in </span><br><span class="line">      &lt;foreach collection&#x3D;&quot;ids&quot; item&#x3D;&quot;item&quot;&gt;#&#123;item&#125;&lt;&#x2F;foreach&gt;</span><br><span class="line">	  1.参数： HashMap  hashMap.put(&quot;ids&quot;, idArray); 其中idArray可以是数组或者集合</span><br><span class="line">	  2..最终SQL语句：select * from emp where name in ids</span><br><span class="line">	  *HashMap中key的名字</span><br><span class="line">	  </span><br><span class="line">	&lt;!--4、应用于查询，参数为JavaBean --&gt;</span><br><span class="line">	  &lt;foreach collection&#x3D;&quot;idArray&quot; item&#x3D;&quot;item&quot;&gt;#&#123;item&#125;&lt;&#x2F;foreach&gt;</span><br><span class="line">      1.参数： JavaBean  param.setIdArray(ids); 其中ids可以是数组或者集合</span><br><span class="line">	  2.SQL语句：collection&#x3D;&quot;idArray&quot;   JavaBean中属性的名字</span><br><span class="line">&lt;!-- ----------------------------------------------------------------------------- --&gt; </span><br><span class="line">	&lt;!--5、应用于增加，参数为参数为List&lt;User&gt; --&gt;</span><br><span class="line">	 &lt;foreach collection&#x3D;&quot;list&quot; item&#x3D;&quot;item&quot; separator&#x3D;&quot;;&quot;&gt;</span><br><span class="line">		insert into	user(username)values(#&#123;item.username&#125;)</span><br><span class="line">     &lt;&#x2F;foreach&gt;</span><br><span class="line">     </span><br><span class="line">	  注意1、传入参数：List&lt;User&gt;</span><br><span class="line">	   2、separator&#x3D;&quot;;&quot;</span><br><span class="line">	   3、#&#123;item.username&#125; item都是一个User类型，username是User类型的属性</span><br><span class="line">	   4、在url上增加 allowMultiQueries&#x3D;true </span><br><span class="line"></span><br><span class="line">	&lt;!--6、应用于增加，参数为参数为List&lt;HashMap&lt;String, String&gt;&gt; --&gt;</span><br><span class="line">      INSERT into user (username) VALUES</span><br><span class="line">		&lt;foreach collection&#x3D;&quot;list&quot; item&#x3D;&quot;item&quot; separator&#x3D;&quot;,&quot;&gt;</span><br><span class="line">			(#&#123;item.username&#125;)</span><br><span class="line">		&lt;&#x2F;foreach&gt;</span><br><span class="line">              注意1、传入参数：List&lt;HashMap&lt;String, String&gt;&gt;</span><br><span class="line">	   2、separator&#x3D;&quot;,&quot;</span><br><span class="line">	   3、#&#123;item.username&#125;  item都是一个hashmap类型，username是key的名字</span><br><span class="line">	   </span><br><span class="line">	&lt;!--7、应用于删除，方法和第5、第6个一样--&gt;</span><br><span class="line">	&lt;!--8、应用于更新，方法和第5个一样</span><br><span class="line">	      注意： foreach应用于第5、7、8，需要在链接数据库的url上增加 </span><br><span class="line">	      ?allowMultiQueries&#x3D;true</span><br><span class="line">	      作用：</span><br><span class="line">	      1.可以在sql语句后携带分号，实现多语句执行。</span><br><span class="line">		  2.可以执行批处理，同时发出多个SQL语句。--&gt;</span><br><span class="line">	&lt;!--9、应用于更新，case..when...then..end --&gt;      </span><br><span class="line">		update user set  gender&#x3D; case id	</span><br><span class="line">		&lt;foreach collection&#x3D;&quot;list&quot; item&#x3D;&quot;item&quot;&gt;</span><br><span class="line">			when  #&#123;item.id&#125; then #&#123;item.gender&#125;</span><br><span class="line">		&lt;&#x2F;foreach&gt;</span><br><span class="line">		end</span><br><span class="line">		where id in (94,95)	      </span><br><span class="line">	  注意：这种方式只使用与MySQL数据库</span><br></pre></td></tr></table></figure>

<p>根据类模糊查询用户列表 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id&#x3D;&quot;findUserListByVo&quot; parameterType&#x3D;&quot;user.QueryListVo&quot; resultType&#x3D;&quot;user.User&quot;&gt;</span><br><span class="line">	select * from user </span><br><span class="line">	&lt;where&gt;</span><br><span class="line">		&lt;if test&#x3D;&quot;Ids !&#x3D; null and Ids.size()&gt;0&quot;&gt;</span><br><span class="line">				&lt;foreach collection&#x3D;&quot;ids&quot; open&#x3D;&quot;and id in(&quot; close &#x3D; &quot;)&quot; item&#x3D;&quot;id&quot; separator&#x3D;&quot;,&quot;&gt;</span><br><span class="line">					#&#123;id&#125;</span><br><span class="line">				&lt;&#x2F;foreach&gt;</span><br><span class="line">		&lt;&#x2F;if&gt;</span><br><span class="line">	&lt;&#x2F;where&gt;   </span><br><span class="line">&lt;&#x2F;select&gt;</span><br></pre></td></tr></table></figure>

<h3 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h3><p><typeAliases> ：标签</p>
<p>可以用来起别名，例如   (当起了别名以后，就不在区分大小写)</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span> <span class="attr">type</span>=<span class="string">"实体类的全限定类名"</span> <span class="attr">alias</span>=<span class="string">"你起得别名"</span>&gt;</span><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 或者使用 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"要配置别名的包"</span>&gt;</span><span class="tag">&lt;/<span class="name">package</span>&gt;</span><span class="comment">&lt;!-- 该包下所有的类都会注册别名，别名就是类名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><mappers>标签中的package标签</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappeers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"dao接口所在的包"</span>&gt;</span><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 该包下所有的接口都会加入，不需要再写mapper resource以及class了 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappeers</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="多表操作"><a href="#多表操作" class="headerlink" title="多表操作"></a>多表操作</h2><p>Mybits中的多表操作给我的感觉就是由一个接口去调用另一个接口的方法，再把返回值封装到自己的类中（不知道说的对不对）</p>
<h3 id="一对一"><a href="#一对一" class="headerlink" title="一对一"></a>一对一</h3><p>首先创建两个实体类，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//set get tostring 方法略</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span>  </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Integer id;</span><br><span class="line">	<span class="keyword">private</span> String username;</span><br><span class="line">	<span class="keyword">private</span> Date birthday;</span><br><span class="line">	<span class="keyword">private</span> String sex;</span><br><span class="line">	<span class="keyword">private</span> String address;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//set get tostring 方法略</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Account</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> ID;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> UID;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> MONEY;</span><br><span class="line">	<span class="keyword">private</span> User user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由于是一对一，所以User只需要当接收类型，不用定义接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IAccount</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function">List&lt;Account&gt; <span class="title">findAllaccount</span><span class="params">()</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function">List&lt;AccountUser&gt; <span class="title">findAllAccountUser</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>主配置文件无需变动，但映射文件的配置要改</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line">     </span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"user.IAccount"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 定义封装的account和user的resultMap --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"user.Account"</span> <span class="attr">id</span>=<span class="string">"accountUserMap"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"ID"</span> <span class="attr">column</span>=<span class="string">"ID"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"UID"</span> <span class="attr">column</span>=<span class="string">"UID"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"MONEY"</span> <span class="attr">column</span>=<span class="string">"MONEY"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 创建一对一的关系映射，封装uesr的内容 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"user"</span> <span class="attr">column</span>=<span class="string">"uid"</span> <span class="attr">javaType</span>=<span class="string">"user.User"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"username"</span> <span class="attr">property</span>=<span class="string">"username"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"birthday"</span> <span class="attr">property</span>=<span class="string">"birthday"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"sex"</span> <span class="attr">property</span>=<span class="string">"sex"</span>/&gt;</span>	</span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"address"</span> <span class="attr">property</span>=<span class="string">"address"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 查询所有 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAllaccount"</span> <span class="attr">resultMap</span>=<span class="string">"accountUserMap"</span>&gt;</span></span><br><span class="line">	select * from count</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里注意，我们引入了新标签      <strong>resultMap</strong>   mybits中的核心</p>
<p>resultType可以把查询结果封装到pojo类型中，但必须pojo类的属性名和查询到的数据库表的字段名一致。<br>如果sql查询到的字段与pojo的属性名不一致，则需要使用<strong>resultMap</strong>将字段名和属性名对应起来，进行手动配置封装，将结果映射到pojo中</p>
<p>换句话说，如果你的数据库表名与你定义的类中字段的名称不一样，<strong>resultMap</strong>能够帮助你封装成一个结果集，只需要说明你的属性名和你的类名分别都是什么即可</p>
<p><strong>resultMap</strong>也可用来进行关联查询</p>
<p>最后将select查询结果resultType 换位resultmap表示结果不是封装到类中而是封装到结果集里</p>
<p>resultMap - type ：这个结果集最终要封装到哪个类里</p>
<p>resultMap - id：这个结果集的唯一标识</p>
<p>id ：主键</p>
<p>result：其他</p>
<p>property=” “ : 对应类中的属性</p>
<p>column=”” 对应数据库表列名</p>
<p>association 标签：用来关联一个对象</p>
<p>association-property：被注入的对象</p>
<p>association-column：关联的属性（外键）</p>
<p>association-javaType：指定pojo中属性的类型</p>
<p>ofType：指定的是映射到list集合属性中pojo的类型。</p>
<p>javaType  ofType 两者选择一个</p>
<p>补充：在一对一时，可以不使用association标签，写sql也可以满足我们的需求</p>
<p>创建一个外部类帮助我们 封装结果</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountUser</span> <span class="keyword">extends</span> <span class="title">Account</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> String username;</span><br><span class="line">	<span class="keyword">private</span> String address;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>将返回的结果封装到这个类，也可以满足需求</p>
<p>sql：select a.*,u.username,u.address from count a , user u where u.id = a.uid;</p>
<h3 id="一对多"><a href="#一对多" class="headerlink" title="一对多"></a>一对多</h3><p>与一对一大致相同，创建两个类，与上面相同，需要将主类中关联的类的字段改成list</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> List&lt;Account&gt; accounts;</span><br></pre></td></tr></table></figure>

<p>接口的方法的返回值改成list</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;User&gt; <span class="title">findAllaccountUser</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p>xml中</p>
<p>association标签更换为collection 标签   |  collection 标签  表示将接受到的多份数据存入list中</p>
<p>association-javaType 属性更换为ofType  |  ofType：指定的是映射到list集合属性中pojo的类型。</p>
<p>其他配置相同</p>
<p>补充：select * from user u left outer join count a on u.id = a.uid    </p>
<p>sql中的左外链接（返回左表的所有数值和于左边有连接的右表数值）</p>
<h3 id="多对多"><a href="#多对多" class="headerlink" title="多对多"></a>多对多</h3><h4 id="方法1：使用sql"><a href="#方法1：使用sql" class="headerlink" title="方法1：使用sql"></a>方法1：使用sql</h4><p>1.创建两个类，类中有各自的链接类的 list&lt;链接类&gt; 属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//省略getset tostring 方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span>  </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Integer id;</span><br><span class="line">	<span class="keyword">private</span> String username;</span><br><span class="line">	<span class="keyword">private</span> Date birthday;</span><br><span class="line">	<span class="keyword">private</span> String sex;</span><br><span class="line">	<span class="keyword">private</span> String address;</span><br><span class="line">	<span class="keyword">private</span> List&lt;Role&gt; roles;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//省略getset tostring 方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Role</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> id ;</span><br><span class="line">	<span class="keyword">private</span> String rolename;</span><br><span class="line">	<span class="keyword">private</span> String roledesc;</span><br><span class="line">	<span class="keyword">private</span> List&lt;User&gt; users;</span><br></pre></td></tr></table></figure>

<p>2.分别建各自的接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IRole</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function">List&lt;Role&gt; <span class="title">findAllrole</span><span class="params">()</span></span>;<span class="comment">//查询所有角色</span></span><br><span class="line">	</span><br><span class="line">	<span class="function">List&lt;User&gt; <span class="title">FindALLUser</span><span class="params">()</span></span>; <span class="comment">//查询角色对应的用户</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IUser</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function">List&lt;User&gt; <span class="title">FindAllUser</span><span class="params">()</span></span>;<span class="comment">//查询所有用户</span></span><br><span class="line">	</span><br><span class="line">	<span class="function">List&lt;Role&gt; <span class="title">FindALLRole</span><span class="params">()</span></span>;<span class="comment">//查询用户的角色</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在写xml中，我第一次是将两个类的mapper写在了一个xml中，我不建议这样做而是将他们分开，成为两个独立的查询</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"user.Role"</span> <span class="attr">id</span>=<span class="string">"roleMap"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"ID"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"rolename"</span> <span class="attr">column</span>=<span class="string">"ROLE_NAME"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"roledesc"</span> <span class="attr">column</span>=<span class="string">"ROLE_DESC"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"users"</span> <span class="attr">ofType</span>=<span class="string">"user.User"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"username"</span> <span class="attr">column</span>=<span class="string">"username"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"birthday"</span> <span class="attr">column</span>=<span class="string">"birthday"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"sex"</span> <span class="attr">column</span>=<span class="string">"sex"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"address"</span> <span class="attr">column</span>=<span class="string">"address"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">collection</span>&gt;</span>	</span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAllrole"</span> <span class="attr">resultMap</span>=<span class="string">"roleMap"</span>&gt;</span></span><br><span class="line">	select u.*,r.id as rid,r.role_name,r.role_desc from role r </span><br><span class="line">	left outer join user_role ur on r.id = ur.rid </span><br><span class="line">	left outer join user u on u.id = ur.uid </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"user.User"</span> <span class="attr">id</span>=<span class="string">"userMap"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"username"</span> <span class="attr">column</span>=<span class="string">"username"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"birthday"</span> <span class="attr">column</span>=<span class="string">"birthday"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"sex"</span> <span class="attr">column</span>=<span class="string">"sex"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"address"</span> <span class="attr">column</span>=<span class="string">"address"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"roles"</span> <span class="attr">ofType</span>=<span class="string">"user.Role"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"ID"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"rolename"</span> <span class="attr">column</span>=<span class="string">"ROLE_NAME"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"roledesc"</span> <span class="attr">column</span>=<span class="string">"ROLE_DESC"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"FindALLUser"</span> <span class="attr">resultMap</span>=<span class="string">"userMap"</span>&gt;</span></span><br><span class="line">	select u.*,r.id as rid,r.role_name,r.role_desc from user u </span><br><span class="line">	left outer join user_role ur on u.id = ur.uid  </span><br><span class="line">	left outer join role r on r.id = ur.rid  </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意：在sql语句换行的时候，要加一个空格，保证在拼接sql的时候不会直接将语句连在一起造成语法错误</p>
<h4 id="方法2：使用select标签"><a href="#方法2：使用select标签" class="headerlink" title="方法2：使用select标签"></a>方法2：使用select标签</h4><p>使用select标签后，就可以其他mapper的方法调用其他接口的方法，将返回值存入自己的结果集</p>
<p>类不动，类的方法都改为查自己</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IUser</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function">List&lt;User&gt; <span class="title">findAllUser</span><span class="params">()</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function">User <span class="title">finduserById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;	</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IAccount</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function">List&lt;Account&gt; <span class="title">findAllaccount</span><span class="params">()</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function">List&lt;Account&gt; <span class="title">findAccountByUid</span><span class="params">(<span class="keyword">int</span> uid)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>xml中</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"user.IAccount"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"user.Account"</span> <span class="attr">id</span>=<span class="string">"accountMap"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"ID"</span> <span class="attr">column</span>=<span class="string">"ID"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"UID"</span> <span class="attr">column</span>=<span class="string">"UID"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"MONEY"</span> <span class="attr">column</span>=<span class="string">"MONEY"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 一对一的关系映射，配置封装user的内容</span></span><br><span class="line"><span class="comment">select属性指定的内容，查询用户的唯一标志  1-1--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"user"</span> <span class="attr">column</span>=<span class="string">"uid"</span> <span class="attr">javaType</span>=<span class="string">"user.User"</span> <span class="attr">select</span>=<span class="string">"user.IUser.finduserById"</span>&gt;</span><span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 查询所有 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAllaccount"</span> <span class="attr">resultMap</span>=<span class="string">"accountMap"</span>&gt;</span></span><br><span class="line">	select * from count </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAccountByUid"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span>  <span class="attr">resultType</span>=<span class="string">"user.Account"</span>&gt;</span></span><br><span class="line">	select * from count where uid = #&#123;id&#125; </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>另一个xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"user.IUser"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 定义封装的account和user的resultMap --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"user.User"</span> <span class="attr">id</span>=<span class="string">"userMap"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"username"</span> <span class="attr">property</span>=<span class="string">"username"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"birthday"</span> <span class="attr">property</span>=<span class="string">"birthday"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"sex"</span> <span class="attr">property</span>=<span class="string">"sex"</span>/&gt;</span>	</span><br><span class="line"><span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"address"</span> <span class="attr">property</span>=<span class="string">"address"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 一对一的关系映射，配置封装user的内容</span></span><br><span class="line"><span class="comment">select属性指定的内容，查询用户的唯一标志  1-多--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"accounts"</span> <span class="attr">ofType</span>=<span class="string">"user.Account"</span> <span class="attr">select</span>=<span class="string">"user.IAccount.findAccountByUid"</span> <span class="attr">column</span>=<span class="string">"id"</span>&gt;</span><span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span><span class="comment">&lt;!-- 接口方法的位置要写明白 --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 查询所有 --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAllUser"</span> <span class="attr">resultMap</span>=<span class="string">"userMap"</span>&gt;</span></span><br><span class="line">	select * from user </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"finduserById"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span> <span class="attr">resultType</span>=<span class="string">"user.User"</span>&gt;</span></span><br><span class="line">	select * from user where id = #&#123;uid&#125; </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>相当于两个完全独立的单表查询，通过select属性，可以调用其他的接口方法。</p>
<p>核心思想与一对多差不多，就是将查询到的结果封装到结果集中再输出</p>
<p>关于JNDI我不太了解，等我学过了我再补充吧</p>
<h2 id="立即加载和延迟加载"><a href="#立即加载和延迟加载" class="headerlink" title="立即加载和延迟加载"></a>立即加载和延迟加载</h2><p>MyBatis根据对关联对象查询的select语句的执行时机，分为三种类型：直接加载、侵入式加载与深度延迟加载</p>
<p>直接加载：执行完对主加载对象的select语句，马上执行对关联对象的select查询。</p>
<p>侵入式延迟：执行对主加载对象的查询时，不会执行对关联对象的查询。但当要访问主加载对象的详情时，就会马上执行关联对象的select查询。即对关联对象的查询执行，侵入到了主加载对象的详情访问中。也可以这样理解：将关联对象的详情侵入到了主加载对象的详情中，即将关联对象的详情作为主加载对象的详情的一部分出现了。</p>
<p>深度延迟：执行对主加载对象的查询时，不会执行对关联对象的查询。访问主加载对象的详情时也不会执行关联对象的select查询。只有当真正访问关联对象的详情时，才会执行对关联对象的select查询。(摘抄)</p>
<p>多对一  ，一对一 ：一般采用立即加载</p>
<p>一对多，多对多：一般采用延时加载</p>
<p>在主配置文件中添加下面的配置即可开启延迟加载，凡是通过结果集包装的都会自动懒加载</p>
<p>因为侵入式延迟加载属于延迟加载的一种，所以要开启深度延迟加载后再开启侵入式延迟加载才生效</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置properties 配置延迟加载参数 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 开启mybits支持延迟加载 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"lazyLoadingEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span><span class="comment">&lt;!--深度延迟加载--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"aggressiveLazyLoading"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span><span class="comment">&lt;!-- 侵入式延迟加载  默认关闭--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="关于缓存"><a href="#关于缓存" class="headerlink" title="关于缓存"></a>关于缓存</h2><p>mybits中有一级缓存和二级缓存（因为我还没做spring整合mybits，这段是摘抄别人的，作为了解）</p>
<p>一级缓存是存在是sqlsession中默认开启，就相当于在多次查询一个用户信息时，并不会多次查询，而是调用上一次的查询结果，但是一旦有 增 删 改 操作，就销毁一级缓存</p>
<p>一级缓存的范围有SESSION和STATEMENT两种，默认是SESSION，如果不想使用一级缓存，可以把一级缓存的范围指定为STATEMENT，这样每次执行完一个Mapper中的语句后都会将一级缓存清除。<br>如果需要更改一级缓存的范围，可以在Mybatis的配置文件中，通过localCacheScope指定。建议不要修改</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"localCacheScope"</span> <span class="attr">value</span>=<span class="string">"STATEMENT"</span>&gt;</span><span class="tag">&lt;/<span class="name">setting</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>当Mybatis整合Spring后，直接通过Spring注入Mapper的形式，如果不是在同一个事务中每个Mapper的每次查询操作都对应一个全新的SqlSession实例，这个时候就不会有一级缓存的命中，但是在同一个事务中时共用的是同一个SqlSession。<br>如有需要可以启用二级缓存。</p>
<p>More Actions二级缓存以<strong>散装数据</strong>的形式存在SqlSessionFactory中，二级缓存默认启用，但是要在每个映射文件中添加<cache></cache>标签即可</p>
<p>二级缓存中</p>
<p>Mybatis的二级缓存是指mapper映射文件。二级缓存的作用域是同一个namespace下的mapper映射文件内容，多个SqlSession共享。Mybatis需要手动设置启动二级缓存。</p>
<p>二级缓存是默认启用的(要生效需要对每个Mapper进行配置)，如想取消，则可以通过Mybatis配置文件中的元素下的子元素来指定cacheEnabled为false</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;settings&gt;</span><br><span class="line"></span><br><span class="line">  &lt;setting name&#x3D;&quot;cacheEnabled&quot; value&#x3D;&quot;false&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;settings&gt;</span><br></pre></td></tr></table></figure>



<p>还有一个条件就是需要当前的查询语句是配置了使用cache的，即上面源码的useCache()是返回true的，默认情况下所有select语句的useCache都是true，如果我们在启用了二级缓存后，有某个查询语句是我们不想缓存的，则可以通过指定其useCache为false来达到对应的效果。<br>如果我们不想该语句缓存，可使用useCache=”false</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id&#x3D;&quot;selectByPrimaryKey&quot; resultMap&#x3D;&quot;BaseResultMap&quot; parameterType&#x3D;&quot;java.lang.String&quot; useCache&#x3D;&quot;false&quot;&gt;</span><br><span class="line"></span><br><span class="line">        select</span><br><span class="line"></span><br><span class="line">        &lt;include refid&#x3D;&quot;Base_Column_List&quot;&#x2F;&gt;</span><br><span class="line"></span><br><span class="line">        from tuser</span><br><span class="line"></span><br><span class="line">        where id &#x3D; #&#123;id,jdbcType&#x3D;VARCHAR&#125;</span><br><span class="line"></span><br><span class="line">    &lt;&#x2F;select&gt;</span><br></pre></td></tr></table></figure>



<p>更多关于cache的资料移步<a href="https://blog.csdn.net/huangli1466384630/article/details/82432128" target="_blank" rel="noopener">https://blog.csdn.net/huangli1466384630/article/details/82432128</a></p>
<h1 id="Mybits简单应用基于注解"><a href="#Mybits简单应用基于注解" class="headerlink" title="Mybits简单应用基于注解"></a>Mybits简单应用基于注解</h1><p>对比xml，注解一目了然</p>
<p>1.建立主配置文件</p>
<p>与xml建立主配置文件相同，但在maperrs 标签中，不再配置映射文件，而是扫描dao接口的注解</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;mappers&gt;</span><br><span class="line">&lt;!-- 如果使用url属性，那么值要写file下的全路径，或者带端口号的全路径 --&gt;</span><br><span class="line">&lt;!-- 指定带有注解的dao接口所在的位置 --&gt;</span><br><span class="line">	&lt;package name&#x3D;&quot;user&quot;&#x2F;&gt;</span><br><span class="line">&lt;&#x2F;mappers&gt;</span><br></pre></td></tr></table></figure>

<p>在接口中使用注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//起别名，property对应变量名，column对应数据库表名</span></span><br><span class="line">	<span class="meta">@Select</span>(<span class="string">"select * from user"</span>)</span><br><span class="line">	<span class="meta">@Results</span>(id=<span class="string">"usermap"</span>,value= &#123;</span><br><span class="line">			<span class="meta">@Result</span>(id=<span class="keyword">true</span>,property=<span class="string">"id"</span>,column=<span class="string">"id"</span>),</span><br><span class="line">			<span class="meta">@Result</span>(property=<span class="string">"username"</span>,column=<span class="string">"username"</span>),</span><br><span class="line">			<span class="meta">@Result</span>(property=<span class="string">"birthday"</span>,column=<span class="string">"birthday"</span>),</span><br><span class="line">			<span class="meta">@Result</span>(property=<span class="string">"sex"</span>,column=<span class="string">"sex"</span>),</span><br><span class="line">			<span class="meta">@Result</span>(property=<span class="string">"address"</span>,column=<span class="string">"address"</span>),</span><br><span class="line">			<span class="meta">@Result</span>(property=<span class="string">"accounts"</span>,column=<span class="string">"id"</span>,many = <span class="meta">@Many</span>(select=<span class="string">"user.IAccount.findAccountByUid"</span>,fetchType=FetchType.LAZY))</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="function">List&lt;User&gt; <span class="title">findAlluser</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="comment">//在上面指定了别名就可以在其他方法中使用</span></span><br><span class="line">	<span class="meta">@Insert</span>(<span class="string">"insert into user(username,birthday,sex,address)values(#&#123;username&#125;,#			&#123;birthday&#125;,#&#123;sex&#125;,#&#123;address&#125;)"</span>)</span><br><span class="line">	<span class="meta">@ResultMap</span>(value= &#123;<span class="string">"usermap"</span>&#125;)</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">saveuser</span><span class="params">(User user)</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Delete</span>(<span class="string">"delete from user where id = #&#123;id&#125;"</span>)</span><br><span class="line">	<span class="comment">//以此类推增删改查</span></span><br></pre></td></tr></table></figure>

<p>注意：</p>
<p>一对多 @many标签</p>
<p>@Result(property=”accounts”,column=”id”,many = @Many(select=”user.IAccount.findAccountByUid”,fetchType=FetchType.LAZY))</p>
<p>select 调用的接口方法</p>
<p>一对一 @one标签</p>
<p>fetchType 加载方法 立即或懒</p>
<p>@Result(property=”user”,column=”uid”,one=@One(select=”user.IUser.findUserById”,fetchType=FetchType.EAGER))</p>
<h1 id="Mybits简单应用基于实体类"><a href="#Mybits简单应用基于实体类" class="headerlink" title="Mybits简单应用基于实体类"></a>Mybits简单应用基于实体类</h1><p>mybits支持我们不使用代理的方式而使用写接口的实现类的方式但不常用，简单说下思路</p>
<p>实现类要完成以下步骤（这个实现类的方法相当于增强方法，增强接口的抽象方法）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">1.根据配置信息创建Connection对象，</span><br><span class="line"></span><br><span class="line">注册驱动，获取连接</span><br><span class="line"></span><br><span class="line">2.获取预处理对象preparedSatement</span><br><span class="line"></span><br><span class="line">此处需要sql</span><br><span class="line"></span><br><span class="line">conn.prepareSatement(sql);</span><br><span class="line"></span><br><span class="line">执行查询</span><br><span class="line"></span><br><span class="line">ResultSet resultset &#x3D; prepareStatement.executeQuery（）；</span><br><span class="line"></span><br><span class="line">3.再把结果集封装为一个list</span><br><span class="line"></span><br><span class="line">此处需要获取list的泛型</span><br><span class="line"></span><br><span class="line">list&lt;E&gt; list &#x3D; new ArrayList();</span><br><span class="line"></span><br><span class="line">while(resultset .next())&#123;</span><br><span class="line"></span><br><span class="line">E element &#x3D; (E) Class.forName(配置的全限定类名).newInstance();</span><br><span class="line"></span><br><span class="line">因为数据库表名能对应类属性名</span><br><span class="line"></span><br><span class="line">所以可以采用反射的方式将返回的信息封装到类中</span><br><span class="line"></span><br><span class="line">list.add(element)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&lt;我们需要配置信息 和映射信息 &gt;</p>
<p>映射信息有两部分 sql语句和封装结果的实体类全限定类名</p>
<p>因此我们将映射信息封装成一个类对象，有string属性保存所实现的方法的全限定类名</p>
<p>还有一个mapper对象属性保存我们的sql语句和封装结果的实体类全限定类名</p>
<p>mapper对象也是新建的，属性有sql 和封装结果的实体类全限定类名</p>
<p>创建接口的代理对象</p>
<p>//根据dao接口的字节码创建dao接口的代理对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">getMapper</span><span class="params">(class&lt;T&gt; daoInterfaceClass)</span></span>&#123;</span><br><span class="line"><span class="comment">//使用动态代理的方式增强，此处是一个Invocationhandler接口，我们需要写一个实现类，在实现类中调用接口的实现方法作为增强方法</span></span><br><span class="line">    Proxy.<span class="keyword">new</span> ProxyInstance(类加载器，代理对象要实现的接口字节码数组，代理方式（增强方法）)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sql语句 和结果的全限定类名 是由xml解析器解析出来的，封装到mapper里，</span><br><span class="line">所实现的方法的全限定类名 可以根据增强方法的接口字节码数组得到</span><br><span class="line">代理方法就是接口实现类方法</span><br></pre></td></tr></table></figure>





<p>这里只举一个小例子</p>
<p>一个对象如上</p>
<p>一个接口如上</p>
<p>一个接口的实现类如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">private InputStream in ;</span><br><span class="line">private SqlSessionFactoryBuilder builder;</span><br><span class="line">private SqlSessionFactory factory;</span><br><span class="line">private IAccountDao userDao;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;1.读取配置文件</span><br><span class="line">	in &#x3D; Resources.getResourceAsStream(&quot;SqlMapConfig.xml&quot;);	</span><br><span class="line">	&#x2F;&#x2F;2.创建sqlsessionfactory</span><br><span class="line">	builder &#x3D; new SqlSessionFactoryBuilder();</span><br><span class="line">	factory &#x3D; builder.build(in);</span><br><span class="line">	&#x2F;&#x2F;3.使用工厂生产创建dao</span><br><span class="line">    userDao &#x3D; new UserdaoImpl(factory);</span><br><span class="line">	</span><br><span class="line">	执行方法</span><br><span class="line">	</span><br><span class="line">	&#x2F;&#x2F;6.释放资源</span><br><span class="line">	in.close();</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;5.使用代理对象执行方法</span><br><span class="line">		List&lt;Account&gt; account &#x3D; userDao.findAlluser();</span><br><span class="line">		</span><br><span class="line">		for(Account user2 : account) &#123;</span><br><span class="line">			System.out.println(user2);</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>


</div>


    <div class="post-guide">
        <div class="item left">
            
              <a href="/2020/04/02/%E7%89%B9%E6%9C%89%E5%90%8D%E6%AC%A1%E6%94%B6%E5%BD%95/%E7%89%B9%E6%9C%89%E5%90%8D%E8%AF%8D/">
                  <i class="fa fa-angle-left" aria-hidden="true"></i>
                  特有名词
              </a>
            
        </div>
        <div class="item right">
            
              <a href="/2020/03/31/%E5%88%9D%E6%AC%A1%E5%B0%9D%E8%AF%95/Hexo%E5%88%9D%E5%B0%9D%E8%AF%95/">
                Hexo初尝试
                <i class="fa fa-angle-right" aria-hidden="true"></i>
              </a>
            
        </div>
    </div>



	<div id="vcomments"></div>


<script>
	
		// 评论
		new Valine({
			av: AV,
			el: '#vcomments',
			notify: false,
			verify: false,
			path: window.location.pathname,
			appId: '',
			appKey: '',
			placeholder: '请输入评论',
			avatar: 'retro',
			recordIP: false
		})
	
	
</script>
	</div>
	
	<button id="totop-toggle" class="toggle"><i class="fa fa-angle-double-up" aria-hidden="true"></i></button>
</body>
</html>